---
import PostLayout from '@/layouts/post-layout.astro'
import Content from '@/components/content/content.astro'
import type { GetStaticPaths } from 'astro'
import type { Post } from '@/types/post'

export const getStaticPaths: GetStaticPaths = async () => {
  const posts = await Astro.glob<Post>('/content/posts/{*,**/index}.mdx')

  const data = posts.map(async ({ default: MdxContent, frontmatter, file }) => {
    const slug = file
      .replace(/\/index.mdx$/, '')
      .split(/[/\\]/)
      .pop()

    return {
      params: { slug },
      props: {
        MdxContent,
        frontmatter
      }
    }
  })

  return Promise.all(data)
}

interface Props {
  MdxContent: Post['default']
  frontmatter: Post['frontmatter']
}

const { MdxContent, frontmatter } = Astro.props as Props
---

<PostLayout
  head={{
    title: frontmatter.title,
    seoTitle: frontmatter.seoTitle,
    description: frontmatter.description,
    imageSrc: frontmatter.image.url,
    imageAlt: frontmatter.image.alt
  }}
>
  <Content MdxContent={MdxContent} />
</PostLayout>
